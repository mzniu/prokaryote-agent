# 原智(YuanZhi) Agent 启动说明

## 系统概述

原智(YuanZhi)已合并两个进化系统为统一的入口：**start.py**

- **旧系统**: goal_evolution.py（单独运行，仅控制台输出）
- **新系统**: start.py（后台进化 + 交互式命令，带日志输出）

## 快速启动

### 1. 基础启动（推荐）

```bash
python start.py
```

默认配置：
- 进化模式：迭代式（Iterative）
- 后台进化间隔：60秒
- 最大能力数量：20个
- 自动启用安全能力：否

### 2. 自定义配置

```bash
python start.py --interval 30 --max-capabilities 50 --auto-enable --mode iterative
```

参数说明：
- `--interval <秒>`: 后台自动进化间隔（默认60秒）
- `--max-capabilities <数量>`: 系统最大能力数（默认20）
- `--auto-enable`: 自动启用安全等级为"safe"的新能力
- `--mode <simple|iterative>`: 进化模式（默认iterative）
  - `simple`: 简单模式（一次性生成）
  - `iterative`: 迭代式进化（多阶段渐进）

## 进化模式对比

### 简单模式（Simple）
- 一次性调用AI生成完整能力
- 适合简单、明确的功能需求
- 速度快，但复杂功能成功率低

### 迭代式模式（Iterative）⭐ 推荐
- 多阶段渐进式进化
- 自动根据复杂度分为1-4个阶段
- 每阶段验证、反馈、改进
- 适合复杂功能开发（如网络搜索、架构设计）
- 成功率显著提升

**复杂度评估**：
- **简单**（1阶段）：描述<150字，验收标准<3条
- **中等**（3阶段）：描述<300字，验收标准<5条
- **复杂**（4阶段）：其他情况

## 交互命令

启动后可使用以下命令：

### 进化相关
```
evolve <描述>   - 立即生成新能力（前台执行）
queue <描述>    - 添加进化任务到队列（后台处理）
goals           - 查看进化目标状态
pause           - 暂停后台自动进化
resume          - 恢复后台自动进化
```

### 能力管理
```
list            - 列出所有能力
enable <ID>     - 启用指定能力
disable <ID>    - 禁用指定能力
info <ID>       - 查看能力详情
```

### 系统监控
```
status          - 查看系统状态
stats           - 查看详细统计
```

### 其他
```
help            - 显示帮助
quit/exit       - 退出程序
```

## 日志查看

### 实时日志
启动时终端会显示：
- 初始化进度
- 进化目标状态
- 后台进化通知
- 命令执行结果

### 历史日志
```bash
# 查看所有进化相关日志
Get-Content prokaryote_agent/log/prokaryote.log | Select-String "进化|evolution"

# 查看最近10条
Get-Content prokaryote_agent/log/prokaryote.log | Select-String "进化" | Select-Object -Last 10

# 查看迭代式进化详情
Get-Content prokaryote_agent/log/prokaryote.log | Select-String "迭代|Iterative|阶段|Stage"
```

## 进化目标管理

### 目标文件
进化目标定义在 `evolution_goals.md`

### 目标格式
```markdown
# 目标标题

**状态**: pending  
**优先级**: high  
**描述**: 详细说明功能需求

**验收标准**:
- [ ] 标准1
- [ ] 标准2
- [ ] 标准3
```

### 自动处理
- 系统按优先级自动选择待执行目标
- 迭代式进化完成后自动标记 [x]
- 记录进化历史和测试通过率

## 工作流程

### 后台自动进化

1. **启动**: `python start.py`
2. **加载**: 系统加载 evolution_goals.md 中的目标
3. **循环**: 
   - 每60秒（可配置）检查一次
   - 选择最高优先级的待执行目标
   - 执行迭代式进化（多阶段）
   - 标记完成并记录日志
4. **空闲优化**: 无新目标时自动扫描已有能力，优化低质量代码

### 手动指引

启动后在 `prokaryote>` 提示符下输入命令：

```bash
# 查看当前进化目标
goals

# 立即进化一个能力
evolve 实现JSON文件解析和序列化功能

# 添加到后台队列
queue 开发Markdown转HTML转换器

# 查看系统状态
status

# 暂停后台进化（专注手动任务）
pause
```

## 能力复用

系统会自动将已有能力传递给AI：

```python
# AI知道可用的27个能力
call_capability("web_search", {"query": "Python最佳实践"})
```

这使得新能力可以组合利用已有功能，避免重复开发。

## 示例：完整开发流程

### 1. 添加进化目标

编辑 `evolution_goals.md`:

```markdown
# 软件开发架构能力

**状态**: pending  
**优先级**: high  
**描述**: 能够分析软件需求，设计系统架构，选择技术栈，生成模块设计文档。

**验收标准**:
- [ ] 能够生成软件架构图（使用Mermaid）
- [ ] 能够推荐合适的技术栈
- [ ] 能够设计模块结构
- [ ] 能够分析代码架构
```

### 2. 启动系统

```bash
python start.py --mode iterative
```

输出：
```
======================================================================
  Prokaryote Agent V0.2 - 混合进化模式
  后台自主进化 + 实时人工指引
======================================================================

[初始化] 正在初始化系统...
✓ 系统初始化成功

[启动] 正在启动核心监控...
✓ 核心监控已启动 (PID: 12345)

[配置] 正在初始化迭代式进化系统...
✓ 迭代式进化系统已就绪
✓ 已加载 2 个进化目标
  - 待执行: 1
  - 已完成: 1
  - 失败: 0

✓ 后台自动进化线程已启动

[配置]
  进化模式: 迭代式 (Iterative)
  自动进化间隔: 60 秒
  能力上限: 20
  后台进化: 启用
  最大迭代次数: 15
  每阶段最大尝试: 3
```

### 3. 监控进化

后台日志显示：
```
[后台进化] 📎 目标: 软件开发架构能力
  优先级: high
  模式: 迭代式
  🔄 开始迭代式进化...
  
阶段 1/4: 基础框架
  迭代 1/3...
  ✅ 测试通过率: 75%
  
阶段 2/4: 核心功能
  迭代 2/3...
  ✅ 测试通过率: 85%
  
...

[后台进化] ✅ 迭代进化成功!
  最佳版本: cap_xyz123
  测试通过率: 95.0%
  总迭代次数: 8
  完成阶段: 4/4
```

### 4. 验证结果

```bash
prokaryote> goals

[进化目标状态]
  总数: 2
  待执行: 0
  已完成: 2
  失败: 0

prokaryote> list

[能力列表] 总数: 28 | 启用: 15 | 禁用: 13
  1. ✓ 🔒 web_search
     通过搜索引擎查询关键词并返回搜索结果摘要...
  2. ✓ 🔒 software_architecture
     分析软件需求，设计系统架构，选择技术栈...
```

## 故障排查

### 问题1: 进化不执行

**检查**：
```bash
prokaryote> status
```

**原因**：
- 后台进化被暂停：输入 `resume`
- 达到能力上限：删除无用能力或增加 `--max-capabilities`
- 无待执行目标：检查 `evolution_goals.md`

### 问题2: API调用失败

**检查配置**：
```bash
cat prokaryote_agent/config/config.json
```

确保 `capability_config.api_key` 已正确设置。

### 问题3: 日志不显示

**检查日志文件**：
```bash
ls prokaryote_agent/log/
Get-Content prokaryote_agent/log/prokaryote.log -Tail 50
```

**增加日志级别**：
编辑代码中的 `logging.basicConfig(level=logging.DEBUG)`

## 最佳实践

### 1. 渐进式目标

将复杂功能分解为多个小目标：

❌ 错误：
```markdown
# 完整的项目管理系统
```

✅ 正确：
```markdown
# 任务管理基础功能
# 任务优先级排序
# 任务依赖关系分析
# 项目进度可视化
```

### 2. 明确验收标准

每个目标应有3-8个具体的验收标准：

```markdown
**验收标准**:
- [ ] 支持添加、删除、修改任务
- [ ] 任务可以设置截止日期
- [ ] 支持导出为JSON格式
- [ ] 错误处理完善
- [ ] 测试通过率≥80%
```

### 3. 利用已有能力

在目标描述中提示AI复用：

```markdown
**描述**: 开发数据可视化能力，可以使用已有的web_search能力获取图表库信息。
```

### 4. 合理设置间隔

根据需求调整进化间隔：

- 快速迭代：`--interval 30`（30秒）
- 平衡模式：`--interval 60`（默认）
- 节省资源：`--interval 300`（5分钟）

## 总结

✅ **统一入口**: 使用 `python start.py` 启动所有功能  
✅ **迭代进化**: 默认使用渐进式多阶段进化，成功率更高  
✅ **自动化**: 后台持续进化，无需手动干预  
✅ **交互式**: 随时通过命令控制和查询  
✅ **日志完整**: 终端 + 文件双重日志记录  
✅ **能力复用**: AI自动利用已有27个能力  

开始你的进化之旅：

```bash
python start.py
```
