# 混合进化模式 - 启动指南

## 特性

✨ **后台自主进化** + **人工实时指引**

程序启动后会：
1. 每N秒自动生成一个新能力（默认60秒）
2. 同时等待您的命令输入
3. 您可以随时：
   - 输入 `evolve <描述>` 立即生成能力
   - 输入 `queue <描述>` 添加任务到队列
   - 输入 `pause` 暂停后台进化
   - 输入 `status` 查看系统状态

## 启动方法

### 1. 配置API密钥（必需）

在 `prokaryote_agent/config/config.json` 中设置：

```json
{
  "capability_config": {
    "api_key": "sk-your-deepseek-api-key"
  }
}
```

**不再需要设置环境变量！** 程序会自动从配置文件加载。

### 2. 运行程序

```bash
# 默认配置（60秒间隔，20个能力上限）
python start.py

# 自定义配置
python start.py --interval 30 --max-capabilities 50 --auto-enable
```

## 参数说明

- `--interval N` - 后台进化间隔（秒），默认60
- `--max-capabilities N` - 能力数量上限，默认20
- `--auto-enable` - 自动启用安全的能力

## 运行示例

```
======================================================================
  Prokaryote Agent V0.2 - 混合进化模式
  后台自主进化 + 实时人工指引
======================================================================

继续启动...(3秒后自动继续)

[初始化] 正在初始化系统...
✓ 系统初始化成功

[启动] 正在启动核心监控...
✓ 核心监控已启动 (PID: 12345)

✓ 后台自动进化线程已启动

[配置]
  自动进化间隔: 60 秒
  能力上限: 20
  自动启用: 否
  后台进化: 启用

[状态]
  系统: 运行中
  内存: 125.34 MB
  CPU: 1.2%
  总进化次数: 0
  后台进化: 启用
  能力统计: 0 个 (启用: 0, 禁用: 0)

[安全] 注册信号处理器...

======================================================================
  系统已就绪 - 混合进化模式
  后台正在持续自主进化，您可随时输入命令指引
  输入 'help' 查看命令 | 'pause' 暂停后台 | 'quit' 退出
======================================================================

prokaryote>  ← 在这里输入命令
```

## 常用命令

```
# 立即生成能力（不等后台周期）
prokaryote> evolve 创建一个计算斐波那契数列的函数

# 查看所有能力
prokaryote> list

# 暂停后台进化
prokaryote> pause

# 恢复后台进化
prokaryote> resume

# 查看系统状态
prokaryote> status

# 查看详细统计
prokaryote> stats

# 退出程序
prokaryote> quit
```

## 工作流程

1. **后台持续进化** - 每15秒（可配置）自动选择一个任务：
   - 优先处理您通过 `queue` 命令添加的任务
   - 否则**调用AI分析当前系统状态，智能决定下一步生成什么能力**
   
2. **人工随时干预** - 您可以随时输入命令：
   - `evolve` 命令会立即执行，优先于后台任务
   - `pause/resume` 控制后台进化
   - `list/info` 查看和管理已生成的能力

3. **双通道并行** - 后台线程和主线程独立运行，互不阻塞

## AI智能决策

程序不再使用预定义的能力模板，而是：

1. **分析当前状态**
   - 统计已有能力数量和类型
   - 识别能力缺口
   
2. **调用AI思考**
   - 将系统状态发送给DeepSeek
   - AI基于以下原则决策：
     * 优先生成基础工具能力
     * 避免与已有能力重复
     * 确保通用性和实用性
     * 考虑能力间的协同效应
   
3. **生成具体描述**
   - AI返回清晰的能力描述
   - 例如："创建一个解析CSV文件并返回列表的函数"
   
4. **执行生成流程**
   - 基于AI的决策调用代码生成
   - 安全检查 → 沙盒测试 → 注册能力
   
5. **失败处理**
   - 如果AI决策失败，**取消本次进化**
   - 不使用fallback避免生成低质量能力
   - 下一个周期继续尝试

## 常见问题

### Q: 后台进化太慢？
A: 使用 `--interval 10` 设置更短的间隔（10秒）

### Q: 后台进化太快？
A: 使用 `--interval 300` 设置更长的间隔（5分钟）

### Q: 如何完全禁止自动进化？
A: 启动后输入 `pause` 命令

### Q: 如何让程序自动启用生成的能力？
A: 启动时添加 `--auto-enable` 参数

### Q: 程序退出后能力会保留吗？
A: 是的，所有能力保存在 `prokaryote_agent/capabilities/` 目录，下次启动自动加载

## 技术细节

- 后台线程为daemon线程，主线程退出时自动结束
- 使用线程锁保护共享资源（进化任务队列）
- 信号处理器在初始化完成后注册，避免日志竞争
- 监控模块以1秒间隔运行，独立于进化线程

---

**开始您的进化之旅！** 🧬
